<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¹ÙˆÙ†Ø§Øª</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… */
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; text-align: center; background-color: #f8f9fa; padding: 20px; margin: 0; color: #333; }
        h2 { color: #1a73e8; margin-bottom: 25px; font-weight: 700; }
        
        /* Ø¥Ø·Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        #reader { width: 100%; max-width: 450px; margin: 0 auto; border: none; border-radius: 20px; overflow: hidden; background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        #result { margin-top: 25px; padding: 25px; background: white; border-radius: 20px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: right; max-width: 450px; margin-left: auto; margin-right: auto; border-top: 5px solid #28a745; }
        
        .info { font-size: 1.15em; margin-bottom: 15px; border-bottom: 1px solid #f1f1f1; padding-bottom: 10px; display: flex; justify-content:å»ºè®¾; }
        .label { font-weight: 700; color: #5f6368; margin-left: 8px; min-width: 100px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        select { width: 100%; padding: 12px 15px; margin-top: 10px; border-radius: 12px; font-size: 1em; border: 2px solid #e0e0e0; background-color: #fff; outline: none; transition: border-color 0.3s; }
        select:focus { border-color: #1a73e8; }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
        button { 
            width: 100%; 
            padding: 16px; 
            margin-top: 20px; 
            border-radius: 15px; 
            font-size: 1.1em; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ø£Ø®Ø¶Ø±) */
        #submitBtn { background-color: #28a745; color: white; }
        #submitBtn:hover { background-color: #218838; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(40, 167, 69, 0.2); }
        #submitBtn:active { transform: translateY(0); }
        #submitBtn:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø£Ø²Ø±Ù‚) */
        #reader button { 
            background-color: #1a73e8 !important; 
            color: white !important; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 20px !important;
            margin: 10px auto !important;
            width: 80% !important;
        }
        #reader button:hover { background-color: #1557b0 !important; }

        #msg { margin-top: 20px; font-weight: 600; color: #d93025; font-size: 1em; }
    </style>
</head>
<body>

    <h2>Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¹ÙˆÙ†Ø§Øª</h2>
    
    <div id="reader"></div>

    <div id="result">
        <div class="info"><span class="label">Ø§Ù„Ø§Ø³Ù…:</span> <span id="res-name"></span></div>
        <div class="info"><span class="label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</span> <span id="res-id"></span></div>
        <div class="info"><span class="label">Ø§Ù„Ø¬Ù‡Ø©:</span> <span id="res-org"></span></div>
        <div class="info"><span class="label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span> <span id="res-region"></span></div>
        <div class="info"><span class="label">Ø§Ù„Ø­ÙŠ:</span> <span id="res-district"></span></div>
        
        <div style="text-align: right; margin-top: 15px;">
            <label class="label" for="aidType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</label>
            <select id="aidType">
                <option value="ÙƒØ±ØªÙˆÙ†Ø© Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©">ðŸ“¦ ÙƒØ±ØªÙˆÙ†Ø© Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©</option>
                <option value="Ù„Ø­ÙˆÙ…">ðŸ¥© Ù„Ø­ÙˆÙ…</option>
                <option value="Ù…Ø¹ÙˆÙ†Ø© Ù†Ù‚Ø¯ÙŠØ©">ðŸ’° Ù…Ø¹ÙˆÙ†Ø© Ù†Ù‚Ø¯ÙŠØ©</option>
                <option value="Ø£Ø®Ø±Ù‰">âœ¨ Ø£Ø®Ø±Ù‰</option>
            </select>
        </div>
        
        <button id="submitBtn" onclick="submitDelivery()">âœ… ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
        <div id="msg"></div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzNQFqyXxTH56GbxxAV4HfYXXkkq9X6BA2-XNTJ6dGfP3uPZ3Vay9c2rNKWCtpvMTe5vw/exec';
        let currentID = "";

        function onScanSuccess(decodedText) {
            try {
                const url = new URL(decodedText);
                currentID = url.searchParams.get("id");
                if (currentID) { fetchData(currentID); }
            } catch (e) { console.error("Invalid QR"); }
        }

        function fetchData(id) {
            document.getElementById('msg').innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
            fetch(`${scriptURL}?id=${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data !== "Not Found") {
                        document.getElementById('result').style.display = 'block';
                        document.getElementById('res-name').innerText = data[1] || "â€”";
                        document.getElementById('res-id').innerText = data[2] || "â€”";
                        document.getElementById('res-org').innerText = data[12] || "â€”";
                        document.getElementById('res-region').innerText = data[6] || "â€”";
                        document.getElementById('res-district').innerText = data[8] || "â€”";
                        document.getElementById('msg').innerText = "";
                    } else {
                        alert("âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…");
                        document.getElementById('msg').innerText = "";
                    }
                });
        }

        function submitDelivery() {
            const btn = document.getElementById('submitBtn');
            const aid = document.getElementById('aidType').value;
            btn.disabled = true;
            document.getElementById('msg').innerText = "ðŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø´ÙŠØª Ø¬ÙˆØ¬Ù„...";
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ id: currentID, aidType: aid }) })
            .then(() => {
                alert("ðŸŽŠ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­");
                location.reload();
            });
        }

        var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250, videoConstraints: { facingMode: { exact: "environment" } } });
        html5QrcodeScanner.render(onScanSuccess);
    </script>
</body>
</html>
